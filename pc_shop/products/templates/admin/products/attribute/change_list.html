{% extends "admin/change_list.html" %}
{% load i18n %}

{% block result_list %}
<div class="collapsible-attributes">
    {% for category in categories %}
    <div class="category-section">
        <div class="category-header" data-category-id="{{ category.id }}" onclick="toggleCategory({{ category.id }})">
            <h3>{{ category.name }} ({{ category.groups|length }} групп)</h3>
            <span class="toggle-icon">▼</span>
        </div>
        <div class="category-groups" id="category-{{ category.id }}">
            {% for group in category.groups %}
            <div class="group-section">
                <div class="group-header" data-group-id="{{ group.id }}" onclick="toggleGroup({{ group.id }})">
                    <h4>{{ group.name }} ({{ group.attributes|length }})</h4>
                    <span class="toggle-icon">▼</span>
                </div>
                <div class="group-attributes" id="group-{{ group.id }}">
                    {% for attribute in group.attributes %}
                    <div class="attribute-item">
                        <div class="attribute-info">
                            <div class="attribute-name">{{ attribute.name }}</div>
                            <div class="attribute-meta">
                                <span class="data-type">{{ attribute.get_data_type_display }}</span>
                                {% if attribute.unit %}
                                <span class="unit">({{ attribute.unit }})</span>
                                {% endif %}
                            </div>
                        </div>
                        <a href="/admin/products/attribute/{{ attribute.id }}/change/">Редактировать</a>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}

{% block extrahead %}
{{ block.super }}
<style>
    :root {
        --primary-bg: #ffffff;
        --text-color: #212529;
        --border-color: #dee2e6;
        --link-color: #447e9b;
    }

    html[data-theme="auto"] {
        --primary-bg: #1a1a1a;
        --text-color: #e0e0e0;
        --border-color: #444;
        --link-color: #6ab0de;
    }

    html[data-theme="dark"] {
        --primary-bg: #1a1a1a;
        --text-color: #e0e0e0;
        --border-color: #444;
        --link-color: #6ab0de;
    }

    .category-header, .group-header {
        background: var(--primary-bg);
        color: var(--text-color);
        border: 1px solid var(--border-color);
        padding: 10px;
        margin: 5px 0;
        display: flex;
        align-items: center;
        justify-content: space-between;
        cursor: pointer;
        border-radius: 4px;
        transition: all 0.3s ease;
    }

    .category-groups, .group-attributes {
        margin-left: 20px;
        display: block;
    }

    .category-header.collapsed + .category-groups,
    .group-header.collapsed + .group-attributes {
        display: none;
    }

    .toggle-icon {
        margin-left: 10px;
        transition: transform 0.2s;
        color: var(--text-color);
    }

    .category-header.collapsed .toggle-icon,
    .group-header.collapsed .toggle-icon {
        transform: rotate(-90deg);
    }

    .attribute-item {
        padding: 10px;
        border: 1px solid var(--border-color);
        margin: 5px 0;
        background: var(--primary-bg);
        color: var(--text-color);
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .attribute-item a {
        color: var(--link-color);
        text-decoration: none;
    }

    .attribute-item a:hover {
        text-decoration: underline;
    }

    .attribute-info {
        flex-grow: 1;
    }

    .attribute-name {
        font-weight: 500;
        margin-bottom: 3px;
    }

    .attribute-meta {
        font-size: 0.9em;
        color: #666;
    }

    .data-type {
        background: #e3f2fd;
        padding: 2px 6px;
        border-radius: 4px;
        margin-right: 8px;
    }

    .unit {
        color: #666;
    }

    /* Для темной темы */
    html[data-theme="dark"] .attribute-meta,
    html[data-theme="dark"] .unit {
        color: #9e9e9e;
    }

    html[data-theme="dark"] .data-type {
        background: #2d4059;
        color: #b3d4fc;
    }

</style>
<script>
    function toggleCategory(categoryId) {
        const header = document.querySelector(`[data-category-id="${categoryId}"]`);
        const content = document.getElementById(`category-${categoryId}`);
        header.classList.toggle('collapsed');
        content.style.display = header.classList.contains('collapsed') ? 'none' : 'block';
        localStorage.setItem(`category-${categoryId}-collapsed`, header.classList.contains('collapsed'));
    }

    function toggleGroup(groupId) {
        const header = document.querySelector(`[data-group-id="${groupId}"]`);
        const content = document.getElementById(`group-${groupId}`);
        header.classList.toggle('collapsed');
        content.style.display = header.classList.contains('collapsed') ? 'none' : 'block';
        localStorage.setItem(`group-${groupId}-collapsed`, header.classList.contains('collapsed'));
    }

    document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('.category-header, .group-header').forEach(header => {
            const id = header.dataset.categoryId || header.dataset.groupId;
            const isCollapsed = localStorage.getItem(
                header.classList.contains('category-header')
                ? `category-${id}-collapsed`
                : `group-${id}-collapsed`
            ) === 'true';

            if (isCollapsed) {
                header.classList.add('collapsed');
                const content = document.getElementById(
                    header.classList.contains('category-header')
                    ? `category-${id}`
                    : `group-${id}`
                );
                content.style.display = 'none';
            }
        });
    });
</script>
{% endblock %}